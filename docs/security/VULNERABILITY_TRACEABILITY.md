# ğŸ”— Vulnerability Traceability Matrix

**Last Updated:** 2025-11-20 (Updated to match actual repository state after codebase verification)  
**Project:** ACME Corporation - Trustworthy Module Registry  
**Phase:** 2 - Security Case Development

This document provides traceability between identified vulnerabilities, their fixes, tests, and documentation to ensure complete coverage and accountability.

---

## Traceability Matrix

| Vulnerability ID | Description                             | STRIDE Category                           | Risk ID         | Status       | Fix Location                         | Test Location                          | Documentation                                                                                                | Verified   |
| ---------------- | --------------------------------------- | ----------------------------------------- | --------------- | ------------ | ------------------------------------ | -------------------------------------- | ------------------------------------------------------------------------------------------------------------ | ---------- |
| **V-001**        | Expired or Forged JWT Tokens Accepted   | Spoofing Identity                         | R-002 (related) | âœ… Fixed     | `src/middleware/jwt_auth.py`         | `tests/unit/test_auth.py`              | [Five Whys Analysis](./Five%20Whys%20Analysis.md#issue-1--expired-or-forged-jwt-tokens-accepted)             | âœ… Yes     |
| **V-002**        | Overly Broad IAM Policy                 | Elevation of Privilege                    | -               | âœ… Fixed     | `infra/modules/iam/main.tf`          | `tests/terraform/iam_policies_test.go` | [Five Whys Analysis](./Five%20Whys%20Analysis.md#issue-2--overly-broad-iam-policy-for-lambda-execution-role) | âœ… Yes     |
| **V-003**        | Unencrypted Temporary Files             | Information Disclosure                    | -               | âœ… Mitigated | Design change (streaming)            | N/A                                    | [Five Whys Analysis](./Five%20Whys%20Analysis.md#issue-3--unencrypted-temporary-files-in-validator-service)  | âœ… Yes     |
| **V-004**        | Validator Timeout DoS                   | Denial of Service                         | -               | âœ… Fixed     | `src/services/validator_service.py`  | `tests/unit/test_validator_timeout.py` | [Five Whys Analysis](./Five%20Whys%20Analysis.md#issue-4--validator-timeout-allows-resource-exhaustion-dos)  | âœ… Yes     |
| **V-005**        | Missing WAF Protection                  | DoS, Information Disclosure               | R-001           | âŒ Not Fixed | N/A                                  | N/A                                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-001-missing-waf-protection)                             | âŒ No      |
| **V-006**        | JWT Secret Not Secured                  | Spoofing Identity                         | R-002           | âš ï¸ Partial   | `src/utils/jwt_secret.py`            | N/A (to be created)                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-002-jwt-secret-not-secured)                             | âš ï¸ Partial |
| **V-007**        | Admin MFA Not Enforced                  | Spoofing Identity, Elevation of Privilege | R-003           | âŒ Not Fixed | N/A                                  | N/A                                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-003-admin-mfa-not-enforced)                             | âŒ No      |
| **V-008**        | SSRF Protection Missing                 | Information Disclosure, Tampering         | R-004           | âŒ Not Fixed | N/A                                  | N/A                                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-004-ssrf-protection-missing)                            | âŒ No      |
| **V-009**        | API Gateway Throttling Missing          | Denial of Service                         | R-005           | âŒ Not Fixed | N/A                                  | N/A                                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-005-api-gateway-throttling-missing)                     | âŒ No      |
| **V-010**        | Token Use-Count Not Enforced            | Spoofing Identity                         | R-006           | âš ï¸ Partial   | `src/services/auth_service.py`       | N/A                                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-006-token-use-count-not-enforced)                       | âš ï¸ Partial |
| **V-011**        | Security Headers Missing                | Information Disclosure                    | R-007           | âœ… Fixed     | `src/middleware/security_headers.py` | N/A (to be created)                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-007-security-headers-missing)                           | âœ… Yes     |
| **V-012**        | S3 Versioning Missing                   | Tampering                                 | R-008           | âŒ Not Fixed | N/A                                  | N/A                                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-008-s3-versioning-missing)                              | âŒ No      |
| **V-013**        | CloudTrail Not Explicitly Configured    | Repudiation                               | R-009           | âŒ Not Fixed | N/A                                  | N/A                                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-009-cloudtrail-not-explicitly-configured)               | âŒ No      |
| **V-014**        | CloudWatch Alarms Missing               | Denial of Service                         | R-010           | âœ… Fixed     | `infra/modules/monitoring/main.tf`   | N/A (to be created)                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-010-cloudwatch-alarms-missing)                          | âœ… Yes     |
| **V-015**        | Upload Event Logging Missing            | Repudiation                               | R-011           | âš ï¸ Partial   | `src/services/package_service.py`    | N/A (to be created)                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-011-upload-event-logging-missing)                       | âš ï¸ Partial |
| **V-016**        | AWS Config Not Configured               | Information Disclosure                    | R-012           | âœ… Fixed     | `infra/modules/config/main.tf`       | N/A (to be created)                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-012-aws-config-not-configured)                          | âœ… Yes     |
| **V-017**        | Log Archiving Missing                   | Repudiation                               | R-013           | âŒ Not Fixed | N/A                                  | N/A                                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-013-log-archiving-missing)                              | âŒ No      |
| **V-018**        | Validator Script Integrity Verification | Tampering                                 | R-014           | âŒ Not Fixed | N/A                                  | N/A                                    | [Security Audit Report](./SECURITY_AUDIT_REPORT.md#r-014-validator-script-integrity-verification)            | âŒ No      |

---

## Detailed Vulnerability Traceability

### âœ… Fixed Vulnerabilities

#### V-001: Expired or Forged JWT Tokens Accepted

- **Discovery Date:** During STRIDE analysis
- **Root Cause:** Authentication not centralized across endpoints
- **Fix Implementation:**
  - **File:** `src/middleware/jwt_auth.py`
  - **Method:** `verify_jwt_token()` - Centralized JWT verification
  - **Changes:** Added token expiration check, signature verification, algorithm validation
- **Test Coverage:**
  - **File:** `tests/unit/test_auth.py`
  - **Tests:** Token expiration, signature validation, algorithm verification
- **Documentation:**
  - [Five Whys Analysis - Issue 1](./Five%20Whys%20Analysis.md#issue-1--expired-or-forged-jwt-tokens-accepted)
  - [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md#-spoofing-identity)
- **Verification:** âœ… Unit tests passing, JWT middleware active
- **Commit Reference:** (Check git history for specific commit)

---

#### V-002: Overly Broad IAM Policy

- **Discovery Date:** During STRIDE analysis
- **Root Cause:** Default AWS managed policies used instead of least-privilege
- **Fix Implementation:**
  - **File:** `infra/modules/iam/main.tf`
  - **Changes:** Scoped IAM policies to specific S3 prefixes (`packages/*`, `validator/inputs/*`), DynamoDB tables, KMS keys
  - **Validation:** Terratest enforces no `Action="*"` or `Resource="*"`
- **Test Coverage:**
  - **File:** `tests/terraform/iam_policies_test.go`
  - **Tests:** Policy validation, least-privilege checks
- **Documentation:**
  - [Five Whys Analysis - Issue 2](./Five%20Whys%20Analysis.md#issue-2--overly-broad-iam-policy-for-lambda-execution-role)
  - [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md#-elevation-of-privilege)
- **Verification:** âœ… Terratest validation passing, IAM policies reviewed
- **Commit Reference:** (Check git history for specific commit)

---

#### V-003: Unencrypted Temporary Files

- **Discovery Date:** During STRIDE analysis
- **Root Cause:** Assumed ephemeral storage would auto-cleanup
- **Fix Implementation:**
  - **File:** `src/services/validator_service.py`
  - **Changes:** Design change - validator scripts streamed directly from S3 without writing temp files
  - **Status:** Mitigated by design, no temp files created
- **Test Coverage:** N/A (design change eliminates risk)
- **Documentation:**
  - [Five Whys Analysis - Issue 3](./Five%20Whys%20Analysis.md#issue-3--unencrypted-temporary-files-in-validator-service)
- **Verification:** âœ… Code review confirms no temp file writes
- **Commit Reference:** (Check git history for specific commit)

---

#### V-004: Validator Timeout DoS

- **Discovery Date:** During STRIDE analysis
- **Root Cause:** Missing per-validator timeout enforcement
- **Fix Implementation:**
  - **File:** `src/services/validator_service.py`
  - **Method:** `execute_validator()` - Added subprocess timeout
  - **Changes:** Configurable timeout (`VALIDATOR_TIMEOUT_SEC`, default 5s), process termination on timeout
- **Test Coverage:**
  - **File:** `tests/unit/test_validator_timeout.py`
  - **Tests:** Timeout enforcement, process termination, CloudWatch metrics
- **Documentation:**
  - [Five Whys Analysis - Issue 4](./Five%20Whys%20Analysis.md#issue-4--validator-timeout-allows-resource-exhaustion-dos)
  - [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md#-denial-of-service-dos)
- **Verification:** âœ… Unit tests passing, timeout working in production
- **Commit Reference:** (Check git history for specific commit)

---

### âŒ Unfixed Vulnerabilities

#### V-005: Missing WAF Protection

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-001 (Critical)
- **Status:** âŒ Not Fixed
- **Planned Fix Location:** `infra/modules/api-gateway/main.tf` (to be created)
- **Planned Test Location:** `tests/integration/test_waf.py` (to be created)
- **Documentation:**
  - [Security Audit Report - R-001](./SECURITY_AUDIT_REPORT.md#r-001-missing-waf-protection)
  - [Risk Matrix - R-001](../RISK_MATRIX.md#r-001-missing-waf-protection)
  - [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md#-denial-of-service-dos)
- **Mitigation Plan:**
  1. Configure AWS WAF on API Gateway
  2. Add AWS Managed Rules (Core Rule Set, Known Bad Inputs)
  3. Add rate-based rules for DoS protection
  4. Test with sample attack patterns
- **Priority:** P0 - Critical
- **Target Fix Date:** Week 1, Day 1-2

---

#### V-006: JWT Secret Not Secured

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-002 (High)
- **Status:** âš ï¸ **Partial** - Function exists but middleware not using it
- **Current State:**
  - `src/utils/jwt_secret.py` - `get_jwt_secret()` function exists to retrieve from Secrets Manager (KMS-encrypted)
  - `infra/modules/monitoring/main.tf` - Secrets Manager secret configured with KMS encryption
  - **Gap:** `src/middleware/jwt_auth.py` (line 53) still uses `os.getenv("JWT_SECRET")` directly, not `get_jwt_secret()` function
- **Implementation Details:**
  - JWT secret storage in AWS Secrets Manager configured (`acme-jwt-secret`)
  - Secret encrypted with customer-managed KMS key
  - `get_jwt_secret()` function implemented with proper fallback logic
  - **Missing:** Middleware not updated to use `get_jwt_secret()` function
- **Remaining Work:**
  - Update `src/middleware/jwt_auth.py` to use `get_jwt_secret()` instead of `os.getenv("JWT_SECRET")`
  - Ensure IAM policies allow Secrets Manager access
- **Planned Test Location:** `tests/unit/test_jwt_secrets_manager.py` (to be created)
- **Documentation:**
  - [Security Audit Report - R-002](./SECURITY_AUDIT_REPORT.md#r-002-jwt-secret-not-secured)
  - [Risk Matrix - R-002](../RISK_MATRIX.md#r-002-jwt-secret-not-secured)
  - [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md#-spoofing-identity)
- **Verification:** âš ï¸ Function exists but middleware not integrated

---

#### V-007: Admin MFA Not Enforced

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-003 (High)
- **Status:** âŒ Not Fixed
- **Planned Fix Location:** `infra/envs/dev/iam_role.tf` (add MFA policy)
- **Planned Test Location:** `tests/terraform/test_mfa_enforcement.go` (to be created)
- **Documentation:**
  - [Security Audit Report - R-003](./SECURITY_AUDIT_REPORT.md#r-003-admin-mfa-not-enforced)
  - [Risk Matrix - R-003](../RISK_MATRIX.md#r-003-admin-mfa-not-enforced)
  - [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md#-spoofing-identity)
- **Mitigation Plan:**
  1. Create IAM policy requiring MFA for admin group
  2. Add condition: `aws:MultiFactorAuthPresent: true`
  3. Test MFA enforcement
  4. Document MFA setup process
- **Priority:** P1 - High
- **Target Fix Date:** Week 1, Day 5

---

#### V-008: SSRF Protection Missing

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-004 (High)
- **Status:** âŒ Not Fixed
- **Planned Fix Location:** `src/middleware/ssrf_protection.py` (to be created)
- **Planned Test Location:** `tests/unit/test_ssrf_protection.py` (to be created)
- **Documentation:**
  - [Security Audit Report - R-004](./SECURITY_AUDIT_REPORT.md#r-004-ssrf-protection-missing)
  - [Risk Matrix - R-004](../RISK_MATRIX.md#r-004-ssrf-protection-missing)
  - [OWASP Top 10 - A10](./SECURITY_AUDIT_REPORT.md#a10-ssrf-server-side-request-forgery)
- **Mitigation Plan:**
  1. Add URL validation middleware
  2. Block internal network access (169.254.169.254, localhost, private IPs)
  3. Whitelist allowed domains if applicable
  4. Add SSRF tests
- **Priority:** P1 - High
- **Target Fix Date:** Week 2, Day 1-2

---

#### V-009: API Gateway Throttling Missing

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-005 (High)
- **Status:** âŒ **Not Fixed**
- **Current State:**
  - Plan output shows `aws_api_gateway_method_settings.throttle_settings` is planned but **NOT in actual code**
  - No `aws_api_gateway_method_settings` resource found in `infra/modules/api-gateway/main.tf`
- **Planned Fix Location:** `infra/modules/api-gateway/main.tf` (to be added)
- **Mitigation Plan:**
  1. Add `aws_api_gateway_method_settings` resource to API Gateway module
  2. Configure throttling rate limit: 2000 requests/second (configurable via variable)
  3. Configure burst limit: 5000 concurrent requests (configurable via variable)
  4. Apply to all methods (`method_path = "*/*"`)
  5. Enable metrics for monitoring
- **Planned Test Location:** `tests/integration/test_api_throttling.py` (to be created)
- **Documentation:**
  - [Security Audit Report - R-005](./SECURITY_AUDIT_REPORT.md#r-005-api-gateway-throttling-missing)
  - [Risk Matrix - R-005](../RISK_MATRIX.md#r-005-api-gateway-throttling-missing)
  - [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md#-denial-of-service-dos)
- **Priority:** P1 - High
- **Target Fix Date:** Week 1, Day 3-4

---

#### V-010: Token Use-Count Not Enforced

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-006 (Medium)
- **Status:** âš ï¸ **Partial** - Function exists but only enforced in `/auth/me` endpoint
- **Current State:**
  - `consume_token_use()` function exists in `src/services/auth_service.py` (line 174)
  - Token use tracking implemented and working
  - **Gap:** Only called in `/auth/me` endpoint (line 377), NOT enforced in JWT middleware
  - Tokens can be reused indefinitely on other protected endpoints
- **Existing Implementation:**
  - `src/services/auth_service.py` - `consume_token_use()` function decrements use count
  - `/auth/me` endpoint enforces use count
- **Remaining Work:**
  - Call `consume_token_use()` in `JWTAuthMiddleware` for all protected endpoints
  - OR: Document that use-count is optional/advisory only
- **Planned Test Location:** `tests/unit/test_token_use_count.py` (to be created)
- **Documentation:**
  - [Security Audit Report - R-006](./SECURITY_AUDIT_REPORT.md#r-006-token-use-count-not-enforced)
  - [Risk Matrix - R-006](../RISK_MATRIX.md#r-006-token-use-count-not-enforced)
  - [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md#-spoofing-identity)
- **Priority:** P2 - Medium

---

#### V-011: Security Headers Missing

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-007 (Medium)
- **Status:** âœ… **Fixed**
- **Fix Location:** `src/middleware/security_headers.py`
- **Implementation Details:**
  - `SecurityHeadersMiddleware` class implemented
  - Headers added: HSTS, X-Content-Type-Options, X-Frame-Options, CSP, Referrer-Policy, Permissions-Policy
  - Configurable HSTS max-age (default: 1 year)
  - X-XSS-Protection for legacy browser support
- **Planned Test Location:** `tests/unit/test_security_headers.py` (to be created)
- **Documentation:**
  - [Security Audit Report - R-007](./SECURITY_AUDIT_REPORT.md#r-007-security-headers-missing)
  - [Risk Matrix - R-007](../RISK_MATRIX.md#r-007-security-headers-missing)
  - [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md#-information-disclosure)
- **Verification:** âœ… SecurityHeadersMiddleware implemented and active
- **Fix Date:** Implemented (verified 2025-01-XX)

---

#### V-012: S3 Versioning Missing

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-008 (Medium)
- **Status:** âŒ **Not Fixed**
- **Current State:**
  - Plan output shows `module.s3.aws_s3_bucket_versioning.this` is planned but **NOT in actual code**
  - No `aws_s3_bucket_versioning` resource found in `infra/modules/s3/main.tf`
- **Planned Fix Location:** `infra/modules/s3/main.tf` (to be added)
- **Mitigation Plan:**
  1. Add `aws_s3_bucket_versioning` resource with `status = "Enabled"` to `infra/modules/s3/main.tf`
  2. Enable versioning on `pkg-artifacts` S3 bucket
  3. Configure lifecycle policies for old versions (optional, for cost optimization)
  4. Test version recovery functionality
- **Documentation:**
  - [Security Audit Report - R-008](./SECURITY_AUDIT_REPORT.md#r-008-s3-versioning-missing)
  - [Risk Matrix - R-008](../RISK_MATRIX.md#r-008-s3-versioning-missing)
  - [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md#-tampering-with-data)
- **Priority:** P2 - Medium
- **Target Fix Date:** Week 2, Day 1-2

---

#### V-013: CloudTrail Not Explicitly Configured

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-009 (Medium)
- **Status:** âŒ **Not Fixed**
- **Current State:**
  - Plan output shows `module.monitoring.aws_cloudtrail.audit_trail` is planned but **NOT in actual code**
  - No CloudTrail resource found in `infra/modules/monitoring/main.tf`
- **Planned Fix Location:** `infra/modules/monitoring/main.tf` (to be added)
- **Mitigation Plan:**
  1. Add explicit CloudTrail trail: `acme-audit-trail`
  2. Enable multi-region trail
  3. Configure S3 bucket for log storage with versioning and KMS encryption
  4. Enable log file validation
  5. Configure data event logging for S3 and DynamoDB
  6. Add KMS encryption for log files
  7. Configure lifecycle policy to transition logs to Glacier after 90 days
- **Planned Test Location:** `tests/terraform/test_cloudtrail.go` (to be created)
- **Documentation:**
  - [Security Audit Report - R-009](./SECURITY_AUDIT_REPORT.md#r-009-cloudtrail-not-explicitly-configured)
  - [Risk Matrix - R-009](../RISK_MATRIX.md#r-009-cloudtrail-not-explicitly-configured)
  - [CloudTrail Configuration Guide](./CLOUDTRAIL_CONFIGURATION.md)
- **Priority:** P2 - Medium
- **Target Fix Date:** Week 2, Day 3-4

---

#### V-014: CloudWatch Alarms Missing

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-010 (Medium)
- **Status:** âœ… **Fixed**
- **Fix Location:** `infra/modules/monitoring/main.tf` (lines 107-176)
- **Implementation Details:**
  - Three CloudWatch alarms configured:
    1. `validator-high-cpu` - CPU utilization > 80%
    2. `validator-high-memory` - Memory utilization > 80%
    3. `validator-task-count` - Running task count < 1
  - CloudWatch dashboard configured for monitoring
  - Alarms use 300-second evaluation periods
- **Planned Test Location:** `tests/terraform/test_cloudwatch_alarms.go` (to be created)
- **Documentation:**
  - [Security Audit Report - R-010](./SECURITY_AUDIT_REPORT.md#r-010-cloudwatch-alarms-missing)
  - [Risk Matrix - R-010](../RISK_MATRIX.md#r-010-cloudwatch-alarms-missing)
- **Verification:** âœ… Three CloudWatch alarms configured in Terraform
- **Fix Date:** Implemented (verified 2025-01-XX)

---

#### V-015: Upload Event Logging Missing

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-011 (Medium)
- **Status:** âš ï¸ **Partial** - Function may exist but not verified in upload endpoints
- **Current State:**
  - `log_upload_event()` function may exist but **NOT called** in upload endpoints (`/init`, `/commit`, `/abort`)
  - Upload endpoints in `src/services/package_service.py` do not call logging function
  - Upload metadata stored in `uploads` table but events not logged to `downloads` table
- **Remaining Work:**
  1. Verify `log_upload_event()` function exists
  2. Call `log_upload_event()` in `/init` endpoint when upload is initiated
  3. Call `log_upload_event()` in `/commit` endpoint when upload is completed
  4. Call `log_upload_event()` in `/abort` endpoint when upload is aborted
  5. Ensure events include: `event_id`, `pkg_name`, `version`, `user_id`, `timestamp`, `event_type`, `status`, `reason`, `upload_id`
- **Planned Test Location:** `tests/unit/test_upload_logging.py` (to be created)
- **Documentation:**
  - [Security Audit Report - R-011](./SECURITY_AUDIT_REPORT.md#r-011-upload-event-logging-missing)
  - [Risk Matrix - R-011](../RISK_MATRIX.md#r-011-upload-event-logging-missing)
- **Priority:** P2 - Medium
- **Target Fix Date:** Week 2, Day 5

---

#### V-016: AWS Config Not Configured

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-012 (Low)
- **Status:** âœ… **Fixed**
- **Fix Location:** `infra/modules/config/main.tf`
- **Implementation Details:**
  - Configuration recorder enabled
  - Delivery channel configured with S3 bucket for snapshots
  - SNS topic for notifications
  - S3 bucket with versioning, KMS encryption, and public access blocking
  - Recorder configured to track all supported resource types
  - Enabled in `infra/envs/dev/main.tf`
- **Planned Test Location:** `tests/terraform/test_aws_config.go` (to be created)
- **Documentation:**
  - [Security Audit Report - R-012](./SECURITY_AUDIT_REPORT.md#r-012-aws-config-not-configured)
  - [Risk Matrix - R-012](../RISK_MATRIX.md#r-012-aws-config-not-configured)
  - [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md#-information-disclosure)
- **Verification:** âœ… AWS Config fully configured in Terraform
- **Fix Date:** Implemented (verified 2025-01-XX)

---

#### V-017: Log Archiving Missing

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-013 (Low)
- **Status:** âŒ **Not Fixed** - Cannot be fixed without CloudTrail (V-013)
- **Current State:**
  - CloudTrail not configured (V-013), so log archiving cannot be implemented
  - No S3 lifecycle policy for CloudTrail logs bucket (bucket doesn't exist yet)
- **Prerequisites:**
  - Must fix V-013 (CloudTrail) first
- **Planned Fix Location:** `infra/modules/monitoring/main.tf` (after CloudTrail is configured)
- **Mitigation Plan:**
  1. Configure CloudTrail first (V-013)
  2. Add S3 lifecycle policy on CloudTrail logs bucket
  3. Configure logs to transition to Glacier storage class after 90 days
  4. Test archiving process
- **Planned Test Location:** `tests/integration/test_log_archiving.py` (to be created)
- **Documentation:**
  - [Security Audit Report - R-013](./SECURITY_AUDIT_REPORT.md#r-013-log-archiving-missing)
  - [Risk Matrix - R-013](../RISK_MATRIX.md#r-013-log-archiving-missing)
  - [CloudTrail Configuration Guide](./CLOUDTRAIL_CONFIGURATION.md)
- **Priority:** P3 - Low (depends on V-013)
- **Target Fix Date:** Week 3 (after CloudTrail is configured)

---

#### V-018: Validator Script Integrity Verification

- **Discovery Date:** 2025-11-14 (Security Audit)
- **Risk ID:** R-014 (Low)
- **Status:** âŒ Not Fixed
- **Planned Fix Location:** `src/services/validator_service.py` (add checksum verification)
- **Planned Test Location:** `tests/unit/test_validator_integrity.py` (to be created)
- **Documentation:**
  - [Security Audit Report - R-014](./SECURITY_AUDIT_REPORT.md#r-014-validator-script-integrity-verification)
  - [Risk Matrix - R-014](../RISK_MATRIX.md#r-014-validator-script-integrity-verification)
- **Mitigation Plan:**
  1. Add checksums for validator scripts
  2. Verify checksums before execution
  3. Store checksums in DynamoDB
  4. Test integrity verification
- **Priority:** P3 - Low
- **Target Fix Date:** Week 4+

---

## Traceability Summary

### Status Breakdown

| Status       | Count  | Percentage |
| ------------ | ------ | ---------- |
| âœ… Fixed     | 7      | 38.9%      |
| âŒ Not Fixed | 9      | 50.0%      |
| âš ï¸ Partial   | 2      | 11.1%      |
| **Total**    | **18** | **100%**   |

### Coverage by STRIDE Category

| STRIDE Category        | Vulnerabilities | Fixed | Not Fixed | Partial |
| ---------------------- | --------------- | ----- | --------- | ------- |
| Spoofing Identity      | 4               | 1     | 1         | 2       |
| Tampering              | 3               | 0     | 2         | 0       |
| Repudiation            | 3               | 1     | 2         | 1       |
| Information Disclosure | 3               | 3     | 0         | 0       |
| Denial of Service      | 4               | 1     | 2         | 0       |
| Elevation of Privilege | 1               | 1     | 0         | 0       |
| **Total**              | **18**          | **7** | **9**     | **2**   |

---

## Test Coverage Summary

### Existing Tests

- âœ… `tests/unit/test_auth.py` - JWT authentication
- âœ… `tests/unit/test_validator_timeout.py` - Validator timeout
- âœ… `tests/terraform/iam_policies_test.go` - IAM policy validation

### Planned Tests (Not Yet Created)

- âŒ `tests/integration/test_waf.py` - WAF protection
- âŒ `tests/unit/test_jwt_secrets_manager.py` - JWT secret management
- âŒ `tests/terraform/test_mfa_enforcement.go` - MFA enforcement
- âŒ `tests/unit/test_ssrf_protection.py` - SSRF protection
- âŒ `tests/integration/test_api_throttling.py` - API throttling
- âŒ `tests/unit/test_token_use_count.py` - Token use-count
- âŒ `tests/unit/test_security_headers.py` - Security headers
- âŒ `tests/integration/test_s3_versioning.py` - S3 versioning
- âŒ `tests/terraform/test_cloudtrail.go` - CloudTrail configuration
- âŒ `tests/terraform/test_cloudwatch_alarms.go` - CloudWatch alarms
- âŒ `tests/unit/test_upload_logging.py` - Upload event logging
- âŒ `tests/terraform/test_aws_config.go` - AWS Config
- âŒ `tests/integration/test_log_archiving.py` - Log archiving
- âŒ `tests/unit/test_validator_integrity.py` - Validator integrity

---

## Related Documentation

- [Risk Matrix](../RISK_MATRIX.md) - Comprehensive risk assessment
- [Security Audit Report](./SECURITY_AUDIT_REPORT.md) - Detailed audit findings
- [STRIDE Coverage Analysis](./STRIDE_COVERAGE_ANALYSIS.md) - Implementation status
- [Five Whys Analysis](./Five%20Whys%20Analysis.md) - Root cause analysis for fixed vulnerabilities
- [STRIDE Threat Model](./stride-threat-level.md) - Threat model documentation

---

## Recent Updates (2025-11-20)

**Document Updated to Match Actual Repository State**

The following vulnerabilities were verified against the codebase:

**Actually Fixed:**

- âœ… **V-001**: JWT Token Validation - Centralized verification implemented
- âœ… **V-002**: IAM Policy Scoping - Least-privilege policies implemented
- âœ… **V-003**: Temporary Files - Design changed to streaming
- âœ… **V-004**: Validator Timeout - Timeout enforcement implemented
- âœ… **V-011**: Security Headers - SecurityHeadersMiddleware implemented
- âœ… **V-014**: CloudWatch Alarms - Three alarms configured in monitoring module
- âœ… **V-016**: AWS Config - Fully configured in config module

**Partial Implementation:**

- âš ï¸ **V-006**: JWT Secret - `get_jwt_secret()` function exists but middleware still uses `os.getenv("JWT_SECRET")` directly
- âš ï¸ **V-010**: Token Use-Count - `consume_token_use()` exists but only called in `/auth/me` endpoint
- âš ï¸ **V-015**: Upload Event Logging - Function may exist but not verified in upload endpoints

**Not Fixed (Previously Marked as Fixed):**

- âŒ **V-009**: API Gateway Throttling - Not found in code (only in plan output)
- âŒ **V-012**: S3 Versioning - Not found in code (only in plan output)
- âŒ **V-013**: CloudTrail - Not found in code (only in plan output)
- âŒ **V-017**: Log Archiving - Cannot be fixed without CloudTrail (V-013)

**Status Correction:** Several vulnerabilities marked as "Fixed" were only in Terraform plan output but not in actual code. Document updated to reflect actual implementation state.

---

_This traceability matrix should be updated whenever vulnerabilities are fixed, tested, or documented._
