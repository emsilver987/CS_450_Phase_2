{% extends 'base.html' %}
{% block title %}Admin Panel - ACME Registry{% endblock %}
{% block content %}
<section class="container">
  <h1>Admin Panel</h1>
  <div class="card" role="alert">
    <h2>Warning</h2>
    <p><strong>This action will reset the entire registry system state.</strong> All packages, metadata, and ratings will be permanently deleted. This action cannot be undone.</p>
  </div>
  <form method="post" action="/admin/reset" aria-label="Reset registry">
    <div class="form-group">
      <label for="confirm-reset" class="required">
        <input 
          type="checkbox" 
          id="confirm-reset" 
          name="confirm" 
          required
          aria-required="true"
          aria-describedby="confirm-help"
        />
        I understand this action cannot be undone
      </label>
      <span id="confirm-help" class="help-text">You must check this box to confirm you understand the consequences</span>
    </div>
    <button 
      class="btn btn-danger" 
      type="submit"
      aria-label="Reset the entire registry"
      onclick="return confirm('Are you absolutely sure you want to reset the registry? This will delete all packages, metadata, and ratings. This action cannot be undone.');"
    >
      Reset Registry
    </button>
  </form>
  <div class="card" style="margin-top: 24px;">
    <h2>LLM Service Status</h2>
    {% if llm_available is defined and llm_available %}
    <p style="color: #10b981;">
      <span style="display: inline-block; width: 8px; height: 8px; background-color: #10b981; border-radius: 50%; margin-right: 6px;"></span>
      AI-Enhanced Features Available
    </p>
    <p style="font-size: 0.875rem; color: #64748b; margin-top: 8px;">
      The LLM service is configured and ready. AI-enhanced features such as license compatibility analysis, lineage extraction, treescore calculation, and improved error messages are active.
    </p>
    {% if llm_status_detail %}
    <details style="margin-top: 12px;">
      <summary style="cursor: pointer; font-size: 0.875rem; color: #64748b;">Show Details</summary>
      <div style="margin-top: 8px; padding: 8px; background-color: #f8fafc; border-radius: 4px; font-size: 0.875rem;">
        <p><strong>API Key Set:</strong> {{ 'Yes' if llm_status_detail.api_key_set else 'No' }}</p>
        <p><strong>Environment Variable Present:</strong> {{ 'Yes' if llm_status_detail.get('env_key_present') else 'No' }}</p>
        <p><strong>API URL:</strong> {{ llm_status_detail.api_url or 'Not set' }}</p>
        <p><strong>Model:</strong> {{ llm_status_detail.api_model or 'Not set' }}</p>
      </div>
    </details>
    {% endif %}
    {% else %}
    <p style="color: #ef4444;">
      <span style="display: inline-block; width: 8px; height: 8px; background-color: #ef4444; border-radius: 50%; margin-right: 6px;"></span>
      AI-Enhanced Features Not Available
    </p>
    <p style="font-size: 0.875rem; color: #64748b; margin-top: 8px;">
      The LLM service is not configured. Configure <code>GEN_AI_STUDIO_API_KEY</code> via AWS Secrets Manager to enable AI-enhanced features.
    </p>
    {% if llm_status_detail %}
    <details style="margin-top: 12px;">
      <summary style="cursor: pointer; font-size: 0.875rem; color: #64748b;">Show Diagnostic Details</summary>
      <div style="margin-top: 8px; padding: 8px; background-color: #fef2f2; border-radius: 4px; font-size: 0.875rem;">
        <p><strong>API Key Set:</strong> {{ 'Yes' if llm_status_detail.api_key_set else 'No' }}</p>
        <p><strong>Environment Variable Present:</strong> {{ 'Yes' if llm_status_detail.get('env_key_present') else 'No' }}</p>
        <p><strong>API URL:</strong> {{ llm_status_detail.api_url or 'Not set' }}</p>
        <p><strong>Model:</strong> {{ llm_status_detail.api_model or 'Not set' }}</p>
        <p style="margin-top: 8px; color: #dc2626;">
          <strong>Troubleshooting:</strong> Check that the secret <code>acme-genai-api-key</code> exists in AWS Secrets Manager with key <code>GEN_AI_STUDIO_API_KEY</code>, and that the ECS task execution role has permissions to read it.
        </p>
      </div>
    </details>
    {% endif %}
    {% endif %}
  </div>
</section>
{% endblock %}


